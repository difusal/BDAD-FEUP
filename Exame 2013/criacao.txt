drop table if exists Aplicacao;
drop table if exists Servidor;
drop table if exists AplicacaoServidor;
drop table if exists Pessoa;
drop table if exists Bug;

CREATE TABLE Pessoa(
	idPessoa integer primary key, 
	nome text, 
	mail text unique
);

CREATE TABLE Aplicacao (
	idAplicacao integer primary key,
	nome text,
	descricao text
);

CREATE TABLE Servidor (
	idServidor integer primary key,
	idResponsavel integer references Pessoa(idPessoa),
	vulneravel text check (vulneravel in ("sim", "nao")) default "nao",
	hostname text
);

CREATE TABLE AplicacaoServidor (
	idAplicacao integer references Aplicacao(idAplicacao),
	idServidor integer references Servidor(idServidor),
	primary key (idAplicacao, idServidor)
);

CREATE TABLE Bug(
	idBug integer primary key, 
	idAplicacao integer references Aplicacao(idAplicacao), 
	idResponsavel integer references Pessoa(idPessoa), 
	descricao text, 
	prioridade integer check ( prioridade > 0 and prioridade < 6), 
	estado text check (estado in ("aberto", "fechado")), 
	vulnerabilidade check (vulnerabilidade in ("sim", "nao"))
);

insert into pessoa(nome, mail) values ("Ana Guedes", "ana.guedes@cica.pt");
insert into pessoa(nome, mail) values ("Leonel Marco", "leonel.marco@cica.pt");
insert into pessoa(nome, mail) values ("Filipe Sousa", "filipe.sousa@cica.pt");
insert into pessoa(nome, mail) values ("Manuel Mario", "manuel.mario@cica.pt");
insert into pessoa(nome, mail) values ("Ana Maria", "ana.maria@cica.pt");
insert into pessoa(nome, mail) values ("João Almeida", "joao.almeida@cica.pt");

insert into aplicacao(nome, descricao) values ("Pessoas", "Gestao de Pessoas");
insert into aplicacao(nome, descricao) values ("Rede", "Gestão de Redes");
insert into aplicacao(nome, descricao) values ("Espaços", "Gestão de Espacos");
insert into aplicacao(nome, descricao) values ("Alunos", "Gestão de Alunos");
insert into aplicacao(nome, descricao) values ("Pagamentos", "Gestão de Pagamentos");
insert into aplicacao(nome, descricao) values ("Propinas", "Gestão de propinas");

insert into servidor(idResponsavel, hostname) values (1, "Rede");
insert into servidor(idResponsavel, hostname) values (2, "Sigarra");
insert into servidor(idResponsavel, hostname) values (3, "Outros");
insert into servidor(idResponsavel, hostname) values (4, "alunos1");
insert into servidor(idResponsavel, hostname) values (5, "alunos2");
insert into servidor(idResponsavel, hostname) values (6, "alunos3");
insert into servidor(idResponsavel, hostname) values (6, "alunos4");

insert into AplicacaoServidor(idAplicacao, idServidor) values (2, 1);
insert into AplicacaoServidor(idAplicacao, idServidor) values (3, 1);
insert into AplicacaoServidor(idAplicacao, idServidor) values (1, 2);
insert into AplicacaoServidor(idAplicacao, idServidor) values (4, 2);
insert into AplicacaoServidor(idAplicacao, idServidor) values (5, 2);
insert into AplicacaoServidor(idAplicacao, idServidor) values (6, 2);
insert into AplicacaoServidor(idAplicacao, idServidor) values (3, 3);
insert into AplicacaoServidor(idAplicacao, idServidor) values (6, 4);
insert into AplicacaoServidor(idAplicacao, idServidor) values (6, 6);
insert into AplicacaoServidor(idAplicacao, idServidor) values (6, 7);
insert into AplicacaoServidor(idAplicacao, idServidor) values (4, 7);
insert into AplicacaoServidor(idAplicacao, idServidor) values (2, 6);

insert into bug(idAplicacao, idResponsavel, descricao, prioridade, estado, vulnerabilidade) values (6, 1, "code injection na pagina de login", 1, "aberto", "sim");
insert into bug(idAplicacao, idResponsavel, descricao, prioridade, estado, vulnerabilidade) values (6, 3, "Butao na pagina de login esta errado", 5, "aberto", "nao");
insert into bug(idAplicacao, idResponsavel, descricao, prioridade, estado, vulnerabilidade) values (2, 5, "Logins invalidos", 3, "aberto", "nao");
insert into bug(idAplicacao, idResponsavel, descricao, prioridade, estado, vulnerabilidade) values (2, 4, "repositorio em falta", 1, "aberto", "nao");
insert into bug(idAplicacao, idResponsavel, descricao, prioridade, estado, vulnerabilidade) values (2, 5, "falha seguranca", 5, "aberto", "sim");

